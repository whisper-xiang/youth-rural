<view class="page">
  <!-- æŸ¥çœ‹æ¨¡å¼ -->
  <block wx:if="{{isView}}">
    <!-- å°é¢å›¾ -->
    <image class="cover" src="{{detail.cover}}" mode="aspectFill" />

    <!-- åŸºæœ¬ä¿¡æ¯ -->
    <view class="section">
      <view class="detail-title">{{detail.title}}</view>
      <view class="detail-meta">
        <view class="meta-row">
          <text class="meta-label">å›¢é˜Ÿï¼š</text>
          <text class="meta-value team">{{detail.teamName}}</text>
        </view>
        <view class="meta-row">
          <text class="meta-label">å­¦é™¢ï¼š</text>
          <text class="meta-value">{{detail.college}}</text>
        </view>
        <view class="meta-row">
          <text class="meta-label">åˆ†ç±»ï¼š</text>
          <text class="meta-value category">{{detail.category}}</text>
        </view>
        <view class="meta-row">
          <text class="meta-label">æäº¤æ—¶é—´ï¼š</text>
          <text class="meta-value">{{detail.submitDate}}</text>
        </view>
      </view>
    </view>

    <!-- æˆæœç®€ä»‹ -->
    <view class="section">
      <view class="section-title">æˆæœç®€ä»‹</view>
      <view class="detail-content">{{detail.content}}</view>
    </view>

    <!-- æˆæœé™„ä»¶ -->
    <view class="section" wx:if="{{detail.files && detail.files.length > 0}}">
      <view class="section-title">æˆæœé™„ä»¶</view>
      <view class="file-list">
        <view class="file-item" wx:for="{{detail.files}}" wx:key="index" bindtap="previewFile" data-file="{{item}}">
          <view class="file-icon file-{{item.type}}"></view>
          <view class="file-info">
            <view class="file-name">{{item.name}}</view>
            <view class="file-size">{{item.size}}</view>
          </view>
          <view class="file-action">æŸ¥çœ‹</view>
        </view>
      </view>
    </view>

    <!-- æˆæœå›¾ç‰‡ -->
    <view class="section" wx:if="{{detail.images && detail.images.length > 0}}">
      <view class="section-title">æˆæœå›¾ç‰‡</view>
      <view class="image-grid">
        <image class="grid-image" wx:for="{{detail.images}}" wx:key="*this" src="{{item}}" mode="aspectFill" bindtap="previewImage" data-src="{{item}}" />
      </view>
    </view>
  </block>

  <!-- æ–°å»ºæ¨¡å¼ -->
  <block wx:else>
    <view class="form">
      <view class="section">
        <view class="section-title">æˆæœä¿¡æ¯</view>
        
        <view class="form-item">
          <view class="label">æˆæœæ ‡é¢˜ <text class="required">*</text></view>
          <input class="input" placeholder="è¯·è¾“å…¥æˆæœæ ‡é¢˜" value="{{form.title}}" bindinput="onInput" data-field="title" />
        </view>

        <view class="form-item">
          <view class="label">æˆæœåˆ†ç±» <text class="required">*</text></view>
          <picker mode="selector" range="{{categories}}" bindchange="onCategoryChange">
            <view class="picker {{form.category ? '' : 'placeholder'}}">{{form.category || 'è¯·é€‰æ‹©åˆ†ç±»'}}</view>
          </picker>
        </view>

        <view class="form-item">
          <view class="label">æˆæœç®€ä»‹ <text class="required">*</text></view>
          <textarea class="textarea" placeholder="è¯·è¯¦ç»†æè¿°æˆæœå†…å®¹" value="{{form.content}}" bindinput="onInput" data-field="content" />
        </view>
      </view>

      <view class="section">
        <view class="section-title">ä¸Šä¼ å°é¢</view>
        <view class="cover-upload" bindtap="chooseCover">
          <image class="cover-preview" wx:if="{{form.cover}}" src="{{form.cover}}" mode="aspectFill" />
          <view class="cover-placeholder" wx:else>
            <text class="placeholder-icon">+</text>
            <text class="placeholder-text">æ·»åŠ å°é¢å›¾</text>
          </view>
        </view>
      </view>

      <view class="section">
        <view class="section-title">ä¸Šä¼ é™„ä»¶</view>
        <view class="file-upload">
          <view class="upload-btn" bindtap="chooseFile">
            <text class="upload-icon">ğŸ“</text>
            <text class="upload-text">æ·»åŠ é™„ä»¶</text>
          </view>
          <view class="uploaded-files">
            <view class="uploaded-item" wx:for="{{form.files}}" wx:key="index">
              <text class="uploaded-name">{{item.name}}</text>
              <text class="uploaded-delete" catchtap="deleteFile" data-index="{{index}}">Ã—</text>
            </view>
          </view>
        </view>
      </view>

      <view class="section">
        <view class="section-title">ä¸Šä¼ å›¾ç‰‡</view>
        <view class="image-upload">
          <view class="upload-item" wx:for="{{form.images}}" wx:key="*this">
            <image class="upload-image" src="{{item}}" mode="aspectFill" />
            <view class="upload-delete" catchtap="deleteImage" data-index="{{index}}">Ã—</view>
          </view>
          <view class="upload-add" bindtap="chooseImage" wx:if="{{form.images.length < 9}}">
            <text class="add-icon">+</text>
          </view>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨æŒ‰é’® -->
    <view class="footer">
      <view class="btn-submit" bindtap="submitForm">æäº¤æˆæœ</view>
    </view>
  </block>
</view>
