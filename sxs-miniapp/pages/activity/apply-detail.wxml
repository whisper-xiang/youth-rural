<view class="page">
  <!-- è¡¨å•åŒºåŸŸ -->
  <view class="form">
    <!-- é¡¹ç›®åŸºæœ¬ä¿¡æ¯ -->
    <view class="section">
      <view class="section-title">
        <text>é¡¹ç›®åŸºæœ¬ä¿¡æ¯</text>
        <view class="status-badge status-{{detail.status}}" wx:if="{{isView}}">{{detail.statusText}}</view>
      </view>
      
      <view class="form-item">
        <view class="label">é¡¹ç›®åç§° <text class="required">*</text></view>
        <input class="input" placeholder="è¯·è¾“å…¥é¡¹ç›®åç§°" value="{{form.title}}" bindinput="onInput" data-field="title" disabled="{{isView}}" />
      </view>

      <view class="form-item">
        <view class="label">é¡¹ç›®ä¸»é¢˜ <text class="required">*</text></view>
        <picker mode="selector" range="{{themeOptions}}" value="{{form.themeIndex || 0}}" bindchange="onThemeChange" disabled="{{isView}}">
          <view class="picker {{form.theme ? '' : 'placeholder'}}">
            {{form.theme || 'è¯·é€‰æ‹©é¡¹ç›®ä¸»é¢˜'}}
          </view>
        </picker>
      </view>

      <view class="form-item">
        <view class="label">å®è·µåœ°ç‚¹ <text class="required">*</text></view>
        <input class="input" placeholder="è¯·è¾“å…¥å®è·µåœ°ç‚¹" value="{{form.location}}" bindinput="onInput" data-field="location" disabled="{{isView}}" />
      </view>

      <view class="form-item">
        <view class="label">å®è·µæ—¶é—´ <text class="required">*</text></view>
        <view class="date-range">
          <picker mode="date" value="{{form.startDate}}" bindchange="onStartDateChange" disabled="{{isView}}">
            <view class="date-picker {{form.startDate ? '' : 'placeholder'}}">{{form.startDate || 'å¼€å§‹æ—¥æœŸ'}}</view>
          </picker>
          <text class="date-sep">è‡³</text>
          <picker mode="date" value="{{form.endDate}}" bindchange="onEndDateChange" disabled="{{isView}}">
            <view class="date-picker {{form.endDate ? '' : 'placeholder'}}">{{form.endDate || 'ç»“æŸæ—¥æœŸ'}}</view>
          </picker>
        </view>
      </view>

      <view class="form-item">
        <view class="label">é¢„ç®—é‡‘é¢ï¼ˆå…ƒï¼‰</view>
        <input class="input" type="digit" placeholder="è¯·è¾“å…¥é¡¹ç›®é¢„ç®—é‡‘é¢" value="{{form.budget}}" bindinput="onInput" data-field="budget" disabled="{{isView}}" />
      </view>
    </view>

    <!-- å›¢é˜Ÿä¿¡æ¯ -->
    <view class="section">
      <view class="section-title">å›¢é˜Ÿä¿¡æ¯</view>
      
      <view class="form-item">
        <view class="label">å›¢é˜Ÿè´Ÿè´£äºº <text class="required">*</text></view>
        <input class="input" placeholder="è¯·è¾“å…¥è´Ÿè´£äººå§“å" value="{{form.leader}}" bindinput="onInput" data-field="leader" disabled="{{isView}}" />
      </view>

      <view class="form-item">
        <view class="label">è”ç³»ç”µè¯ <text class="required">*</text></view>
        <input class="input" type="number" placeholder="è¯·è¾“å…¥è”ç³»ç”µè¯" value="{{form.phone}}" bindinput="onInput" data-field="phone" disabled="{{isView}}" />
      </view>

      <view class="form-item">
        <view class="label">æŒ‡å¯¼æ•™å¸ˆ</view>
        <picker mode="selector" range="{{teacherOptions}}" range-key="name" value="{{form.teacherIndex || 0}}" bindchange="onTeacherChange" disabled="{{isView}}">
          <view class="picker {{form.teacher ? '' : 'placeholder'}}">
            {{form.teacher || 'è¯·é€‰æ‹©æŒ‡å¯¼æ•™å¸ˆ'}}
          </view>
        </picker>
      </view>

      <view class="form-item">
        <view class="label">å›¢é˜Ÿæˆå‘˜</view>
        <block wx:if="{{isView}}">
          <block wx:if="{{detail.members && detail.members.length > 0}}">
            <view class="members-list">
              <view class="member-item" wx:for="{{detail.members}}" wx:key="user_id">
                <view class="member-avatar">{{item.name ? item.name[0] : '?'}}</view>
                <view class="member-info">
                  <view class="member-name">{{item.name}}</view>
                  <view class="member-role">{{item.role === 'leader' ? 'è´Ÿè´£äºº' : 'æˆå‘˜'}}</view>
                </view>
                <view class="member-contact" wx:if="{{item.phone}}">
                  <text class="contact-icon">ğŸ“±</text>
                  <text class="contact-text">{{item.phone}}</text>
                </view>
                <view class="member-resp" wx:if="{{item.responsibility}}">èŒè´£ï¼š{{item.responsibility}}</view>
              </view>
            </view>
          </block>
          <block wx:else>
            <view class="members-text">{{form.members || 'æš‚æ— å›¢é˜Ÿæˆå‘˜ä¿¡æ¯'}}</view>
          </block>
        </block>
        <textarea class="textarea" placeholder="æ ¼å¼ï¼šå§“å-å­¦å·-ç”µè¯ï¼Œå¤šä¸ªæˆå‘˜æ¢è¡Œæˆ–åˆ†å·éš”å¼€ã€‚ä¾‹ï¼šå¼ ä¸‰-2021001-13800138000" value="{{form.members}}" bindinput="onInput" data-field="members" disabled="{{isView}}" wx:else />
      </view>
    </view>

    <!-- é¡¹ç›®å†…å®¹ -->
    <view class="section">
      <view class="section-title">é¡¹ç›®å†…å®¹</view>
      
      <view class="form-item">
        <view class="label">é¡¹ç›®ç®€ä»‹ <text class="required">*</text></view>
        <textarea class="textarea" placeholder="è¯·ç®€è¦æè¿°é¡¹ç›®å†…å®¹ï¼ˆ200å­—ä»¥å†…ï¼‰" value="{{form.description}}" bindinput="onInput" data-field="description" maxlength="200" disabled="{{isView}}" />
      </view>

      <view class="form-item">
        <view class="label">å®è·µè®¡åˆ’</view>
        <textarea class="textarea tall" placeholder="è¯·è¯¦ç»†æè¿°å®è·µè®¡åˆ’å®‰æ’" value="{{form.plan}}" bindinput="onInput" data-field="plan" disabled="{{isView}}" />
      </view>

      <view class="form-item">
        <view class="label">é¢„æœŸæˆæœ</view>
        <textarea class="textarea" placeholder="è¯·æè¿°é¢„æœŸæˆæœ" value="{{form.expectedResult}}" bindinput="onInput" data-field="expectedResult" disabled="{{isView}}" />
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æŒ‰é’® -->
  <view class="footer" wx:if="{{!isView}}">
    <view class="btn-submit" bindtap="submitForm">æäº¤ç”³æŠ¥</view>
  </view>

  <!-- è¯„ä¼˜ç»“æœå±•ç¤º -->
  <view class="evaluation-card" wx:if="{{isView && detail.evaluation && (detail.evaluation.final_score || detail.evaluation.award_level)}}">
    <view class="evaluation-header">
      <view class="evaluation-title">è¯„ä¼˜ç»“æœ</view>
      <view class="evaluation-activity">{{detail.evaluation.evaluation_title}}</view>
    </view>
    <view class="evaluation-body">
      <view class="evaluation-score-box" wx:if="{{detail.evaluation.final_score}}">
        <view class="evaluation-score-value">{{detail.evaluation.final_score}}</view>
        <view class="evaluation-score-label">æœ€ç»ˆè¯„åˆ†</view>
      </view>
      <view class="evaluation-award-box" wx:if="{{detail.evaluation.award_level}}">
        <view class="evaluation-award-level">{{detail.evaluation.award_level}}</view>
        <view class="evaluation-award-label">è·å¥–ç­‰çº§</view>
      </view>
    </view>
  </view>

  <!-- æŸ¥çœ‹æ¨¡å¼ä¸‹çš„æ“ä½œæŒ‰é’® -->
  <view class="footer" wx:if="{{isView}}">
    <view class="btn-revoke" wx:if="{{detail.status === 'pending'}}" bindtap="revokeProject">æ’¤é”€ç”³è¯·</view>
    <view class="btn-edit" wx:if="{{detail.status === 'rejected' || detail.status === 'withdrawn'}}" bindtap="goToEdit">ä¿®æ”¹ç”³æŠ¥</view>
    <view class="btn-result" wx:if="{{detail.status === 'approved' && canSubmitResult}}" bindtap="goToResult">æäº¤æˆæœ</view>
    <view class="btn-progress" wx:if="{{detail.status === 'approved' && canUploadProgress}}" bindtap="goToProgress">ä¸Šä¼ è¿›åº¦</view>
    <view class="btn-close" wx:if="{{canCloseProject && detail.status === 'approved'}}" bindtap="closeProject">ç»“é¡¹</view>
  </view>
</view>
