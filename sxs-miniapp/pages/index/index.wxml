<view class="page">
  <!-- 顶部 Banner -->
  <view class="banner">
    <view class="banner-bg"></view>
    <!-- 流程指引按钮 -->
    <view class="process-guide-btn" bindtap="showProcessGuide">
      <view class="process-icon">📋</view>
    </view>
    <view class="banner-content">
      <view class="banner-icon">🌾</view>
      <view class="banner-text">
        <view class="banner-title">大学生暑期"三下乡"</view>
        <view class="banner-subtitle">社会实践活动管理系统</view>
      </view>
    </view>

    <!-- 登录按钮（未登录） -->
    <view class="banner-login" wx:if="{{!isLogin}}" bindtap="goLogin">
      <view class="login-avatar">👤</view>
      <view class="login-text">点击登录</view>
    </view>
  </view>

  <!-- 功能模块入口 (所有登录角色) -->
  <view class="module-section" wx:if="{{isLogin && modules.length > 0}}">
    <view class="section-header">
      <view class="section-title">功能模块</view>
      <view class="section-hint">根据您的身份显示</view>
    </view>
    <view class="module-grid">
      <view class="module-card" wx:for="{{modules}}" wx:key="key" bindtap="goToPage" data-url="{{item.url}}">
        <view class="module-icon-wrap">
          <view class="module-icon {{item.icon}}"></view>
        </view>
        <view class="module-info">
          <view class="module-name">{{item.name}}</view>
          <view class="module-desc">{{item.desc}}</view>
        </view>
        <view class="module-arrow">›</view>
      </view>
    </view>
  </view>

  <!-- 未登录提示 -->
  <view class="empty-section" wx:if="{{!isLogin}}">
    <view class="empty-icon">🔐</view>
    <view class="empty-title">请先登录</view>
    <view class="empty-desc">登录后可查看您的功能模块</view>
    <view class="empty-btn" bindtap="goLogin">立即登录</view>
  </view>

  <!-- 无模块提示 -->
  <view class="empty-section" wx:if="{{modules.length === 0 && isLogin && !isStudent}}">
    <view class="empty-icon">📋</view>
    <view class="empty-title">暂无可用模块</view>
    <view class="empty-desc">当前角色暂无可用功能模块</view>
  </view>
</view>

<!-- 流程指引弹窗 -->
<view class="process-modal" wx:if="{{showProcessModal}}">
  <view class="modal-mask" bindtap="hideProcessGuide"></view>
  <view class="modal-content">
    <view class="modal-header">
      <view class="modal-title">
        <text class="modal-icon">📋</text>
        <text>项目全流程</text>
      </view>
      <view class="modal-close" bindtap="hideProcessGuide">×</view>
    </view>
    <view class="modal-body">
      <view class="process-notice">
        <view class="notice-icon">⚠️</view>
        <view class="notice-text">
          <view class="notice-title">重要说明</view>
          <view class="notice-desc">指导老师确认前，申报信息可修改编辑；确认后基本信息不可修改，只能补充项目成果</view>
        </view>
      </view>
      <scroll-view class="process-scroll" scroll-y>
        <view class="process-step">
          <view class="step-number">1</view>
          <view class="step-info">
            <view class="step-title">创建申报 <text class="step-role">（学生）</text></view>
            <view class="step-desc">填写项目基本信息、团队成员、指导老师、预算明细、实践计划等完整材料</view>
          </view>
        </view>
        <view class="process-step">
          <view class="step-number">2</view>
          <view class="step-info">
            <view class="step-title">指导确认 <text class="step-role">（指导老师）</text></view>
            <view class="step-desc">指导老师审核申报材料，确认项目计划可行性，确认后自动提交学院审核</view>
          </view>
        </view>
        <view class="process-step">
          <view class="step-number">3</view>
          <view class="step-info">
            <view class="step-title">学院初审 <text class="step-role">（学院管理员）</text></view>
            <view class="step-desc">审核申报合理性、团队资格、预算可行性，提供修改建议</view>
          </view>
        </view>
        <view class="process-step">
          <view class="step-number">4</view>
          <view class="step-info">
            <view class="step-title">校级终审 <text class="step-role">（校级管理员）</text></view>
            <view class="step-desc">评估项目创新性、社会影响，确认是否符合全校标准并立项</view>
          </view>
        </view>
        <view class="process-step">
          <view class="step-number">5</view>
          <view class="step-info">
            <view class="step-title">项目实施 <text class="step-role">（学生+老师）</text></view>
            <view class="step-desc">立项后按计划开展活动，定期提交进度报告，导师全程指导监督</view>
          </view>
        </view>
        <view class="process-step">
          <view class="step-number">6</view>
          <view class="step-info">
            <view class="step-title">结项申请 <text class="step-role">（学生）</text></view>
            <view class="step-desc">项目完成后提交结项报告、成果展示、财务报告，申请结项审核</view>
          </view>
        </view>
        <view class="process-step">
          <view class="step-number">7</view>
          <view class="step-info">
            <view class="step-title">指导确认 <text class="step-role">（指导老师）</text></view>
            <view class="step-desc">指导老师审核结项材料，确认项目成果和质量，确认后自动提交学院审核</view>
          </view>
        </view>
        <view class="process-step">
          <view class="step-number">8</view>
          <view class="step-info">
            <view class="step-title">学院审核 <text class="step-role">（学院管理员）</text></view>
            <view class="step-desc">审核结项材料完整性和质量，确认后提交校级审核</view>
          </view>
        </view>
        <view class="process-step">
          <view class="step-number">9</view>
          <view class="step-info">
            <view class="step-title">校级审核 <text class="step-role">（校级管理员）</text></view>
            <view class="step-desc">最终审核结项材料，确认后结项成功，进入评优流程</view>
          </view>
        </view>
        <view class="process-step">
          <view class="step-number">10</view>
          <view class="step-info">
            <view class="step-title">项目评优 <text class="step-role">（评审专家+校级管理员）</text></view>
            <view class="step-desc">符合结项标准的项目参与评优，专家匿名评审，公开评选结果</view>
          </view>
        </view>
      </scroll-view>
    </view>
  </view>
</view>
