# 三下乡活动管理系统 - 数据库设计

## 数据库概览

- **数据库**: MySQL 8.0+
- **字符集**: utf8mb4
- **数据库名**: sxs_db

## ER 关系图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              用户与权限模块                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌──────────────┐         ┌──────────────┐                                │
│   │  sys_user    │ N ──── 1│ sys_college  │                                │
│   │  用户表       │         │  学院表       │                                │
│   └──────────────┘         └──────────────┘                                │
│         │                                                                   │
└─────────┼───────────────────────────────────────────────────────────────────┘
          │
          │ 1
          │
┌─────────┼───────────────────────────────────────────────────────────────────┐
│         │                    项目申报模块                                    │
├─────────┼───────────────────────────────────────────────────────────────────┤
│         │                                                                   │
│         ▼ N                                                                 │
│   ┌──────────────┐                                                         │
│   │   project    │──────────────────────────────────────┐                  │
│   │   项目表      │                                      │                  │
│   └──────────────┘                                      │                  │
│         │                                               │                  │
│    ┌────┴────┬────────────┐                            │                  │
│    │ 1       │ 1          │ 1                          │                  │
│    ▼ N       ▼ N          ▼ N                          │                  │
│ ┌────────┐ ┌────────────┐ ┌─────────────────┐          │                  │
│ │project │ │project_    │ │approval_record  │          │                  │
│ │_member │ │attachment  │ │审批记录表        │          │                  │
│ │成员表   │ │附件表       │ └─────────────────┘          │                  │
│ └────────┘ └────────────┘                              │                  │
│                                                        │                  │
└────────────────────────────────────────────────────────┼──────────────────┘
                                                         │
┌────────────────────────────────────────────────────────┼──────────────────┐
│                         进度跟踪模块                     │                  │
├────────────────────────────────────────────────────────┼──────────────────┤
│                                                        │ 1                │
│   ┌──────────────┐                                     │                  │
│   │   progress   │◄────────────────────────────────────┘                  │
│   │   进度表      │ N                                                      │
│   └──────────────┘                                                        │
│         │                                                                  │
│    ┌────┴────┐                                                            │
│    │ 1       │ 1                                                          │
│    ▼ N       ▼ N                                                          │
│ ┌────────────┐ ┌─────────────────┐                                        │
│ │progress_   │ │progress_comment │                                        │
│ │image       │ │评论表            │                                        │
│ │图片表       │ └─────────────────┘                                        │
│ └────────────┘                                                            │
│                                                                           │
└───────────────────────────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────────────────┐
│                           成果管理模块                                      │
├───────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│   ┌──────────────┐                                                        │
│   │    result    │◄──── 关联 project                                      │
│   │    成果表     │                                                        │
│   └──────────────┘                                                        │
│         │                                                                  │
│    ┌────┴────┐                                                            │
│    │ 1       │ 1                                                          │
│    ▼ N       ▼ N                                                          │
│ ┌────────────┐ ┌────────────┐                                             │
│ │result_     │ │result_     │                                             │
│ │attachment  │ │image       │                                             │
│ │附件表       │ │图片表       │                                             │
│ └────────────┘ └────────────┘                                             │
│                                                                           │
└───────────────────────────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────────────────┐
│                           评优管理模块                                      │
├───────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│   ┌──────────────┐                                                        │
│   │  evaluation  │ 评优活动表                                              │
│   └──────────────┘                                                        │
│         │                                                                  │
│         │ 1                                                               │
│         ▼ N                                                               │
│   ┌──────────────────┐         ┌──────────────────┐                       │
│   │evaluation_project│ N ──── N│ evaluation_score │                       │
│   │项目关联表         │         │ 专家评分表        │                       │
│   └──────────────────┘         └──────────────────┘                       │
│                                                                           │
└───────────────────────────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────────────────┐
│                           通知公告模块                                      │
├───────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│   ┌──────────────┐                                                        │
│   │    notice    │ 通知公告表                                              │
│   └──────────────┘                                                        │
│         │                                                                  │
│    ┌────┴────┬────────────┐                                               │
│    │ 1       │ 1          │ 1                                             │
│    ▼ N       ▼ N          ▼ N                                             │
│ ┌────────────┐ ┌────────────┐ ┌────────────┐                              │
│ │notice_     │ │notice_read │ │user_       │                              │
│ │attachment  │ │已读记录     │ │favorite    │                              │
│ │附件表       │ └────────────┘ │收藏表       │                              │
│ └────────────┘               └────────────┘                              │
│                                                                           │
└───────────────────────────────────────────────────────────────────────────┘
```

## 表结构说明

### 1. 用户与权限模块

| 表名 | 说明 | 主要字段 |
|------|------|----------|
| `sys_user` | 用户表 | id, username, password, real_name, role, college_id |
| `sys_college` | 学院表 | id, name, code |

**角色类型 (role)**:
- `student` - 学生/团队负责人
- `teacher` - 指导教师
- `college_admin` - 学院管理员
- `school_admin` - 校级管理员
- `expert` - 评审专家

### 2. 项目申报模块

| 表名 | 说明 | 主要字段 |
|------|------|----------|
| `project` | 项目申报表 | id, project_no, title, category, leader_id, status |
| `project_member` | 团队成员表 | project_id, user_id, role |
| `project_attachment` | 项目附件表 | project_id, file_name, file_url |

**项目类别 (category)**:
- `乡村振兴`
- `支教助学`
- `红色文化`
- `科技支农`
- `医疗卫生`
- `法律援助`
- `其他`

**项目状态 (status)**:
- `pending` - 待学院审批
- `college_approved` - 学院审批通过，待校级审批
- `school_approved` - 校级审批通过（立项成功）
- `approved` - 已立项
- `rejected` - 已驳回
- `closed` - 已结项

### 3. 审批管理模块

| 表名 | 说明 | 主要字段 |
|------|------|----------|
| `approval_record` | 审批记录表 | project_id, approver_id, approval_level, action, opinion |

### 4. 进度跟踪模块

| 表名 | 说明 | 主要字段 |
|------|------|----------|
| `progress` | 进度记录表 | project_id, title, content, progress_date |
| `progress_image` | 进度图片表 | progress_id, image_url |
| `progress_comment` | 进度评论表 | progress_id, user_id, content |

### 5. 成果管理模块

| 表名 | 说明 | 主要字段 |
|------|------|----------|
| `result` | 成果表 | project_id, title, category, content, status |
| `result_attachment` | 成果附件表 | result_id, file_name, file_url |
| `result_image` | 成果图片表 | result_id, image_url |

**成果类别 (category)**:
- `report` - 调研报告
- `paper` - 学术论文
- `video` - 视频作品
- `other` - 其他成果

### 6. 评优管理模块

| 表名 | 说明 | 主要字段 |
|------|------|----------|
| `evaluation` | 评优活动表 | title, year, start_time, end_time, status |
| `evaluation_project` | 评优项目关联表 | evaluation_id, project_id, final_score, award_level |
| `evaluation_score` | 专家评分表 | evaluation_id, project_id, expert_id, total_score |

**评分维度**:
- `score_innovation` - 创新性 (权重 30%)
- `score_practice` - 实践性 (权重 30%)
- `score_effect` - 成效性 (权重 25%)
- `score_report` - 报告质量 (权重 15%)

### 7. 通知公告模块

| 表名 | 说明 | 主要字段 |
|------|------|----------|
| `notice` | 通知公告表 | title, type, content, is_top, status |
| `notice_attachment` | 通知附件表 | notice_id, file_name, file_url |
| `notice_read` | 已读记录表 | notice_id, user_id, read_time |
| `user_favorite` | 用户收藏表 | user_id, target_type, target_id |

**通知类型 (type)**:
- `notice` - 通知
- `policy` - 政策
- `activity` - 活动

### 8. 系统模块

| 表名 | 说明 | 主要字段 |
|------|------|----------|
| `sys_message` | 系统消息表 | user_id, title, content, type, is_read |
| `sys_log` | 操作日志表 | user_id, module, action, ip |

## 索引设计

每个表都设计了合理的索引：
- 主键索引 (PRIMARY KEY)
- 外键关联索引 (INDEX idx_xxx)
- 唯一约束索引 (UNIQUE KEY uk_xxx)
- 常用查询字段索引 (status, type, created_at 等)

## 使用方法

```bash
# 1. 登录 MySQL
mysql -u root -p

# 2. 执行建表脚本
source /path/to/schema.sql

# 3. 验证
USE sxs_db;
SHOW TABLES;
```

## 测试账号

| 用户名 | 密码 | 角色 |
|--------|------|------|
| admin | 123456 | 校级管理员 |
| 2021001 | 123456 | 学生 |
| T001 | 123456 | 指导教师 |
| CA001 | 123456 | 学院管理员 |
| E001 | 123456 | 评审专家 |
