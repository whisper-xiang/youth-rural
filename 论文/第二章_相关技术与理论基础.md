# 第二章 相关技术与理论基础

## 2.1 微信小程序技术概述

### 2.1.1 微信小程序简介

微信小程序是腾讯公司于2017年1月正式推出的一种轻量级应用形态，运行于微信客户端之上。小程序无需下载安装，用户通过扫描二维码或搜索即可打开使用，具有"触手可及、用完即走"的特点。

截至2024年，微信小程序日活跃用户已超过5亿，覆盖了电商、出行、政务、教育等众多领域。小程序生态的繁荣为各类应用的开发提供了良好的平台基础。

### 2.1.2 小程序技术架构

微信小程序采用独特的双线程架构，将渲染层（View）和逻辑层（App Service）分离：

（1）**渲染层**：负责页面的渲染展示，使用WebView进行渲染。每个页面对应一个WebView线程，多个页面可以有多个WebView线程。

（2）**逻辑层**：负责业务逻辑处理，运行在JSCore中。逻辑层是单线程的，所有页面共享同一个逻辑层。

（3）**通信机制**：渲染层和逻辑层之间通过微信客户端（Native）进行通信，采用事件驱动的方式进行数据交互。

这种架构设计的优势在于：逻辑层和渲染层分离，避免了JavaScript执行阻塞页面渲染；同时，微信客户端作为中间层，可以对小程序的行为进行管控，保证安全性。

### 2.1.3 小程序开发框架

微信小程序提供了完整的开发框架，主要包括以下几个部分：

**（1）WXML（WeiXin Markup Language）**

WXML是小程序的标记语言，类似于HTML，用于描述页面结构。WXML支持数据绑定、条件渲染、列表渲染等特性。示例代码：

```xml
<view class="container">
  <text>{{message}}</text>
  <view wx:for="{{list}}" wx:key="id">
    <text>{{item.name}}</text>
  </view>
</view>
```

**（2）WXSS（WeiXin Style Sheets）**

WXSS是小程序的样式语言，类似于CSS，用于描述页面样式。WXSS扩展了rpx（responsive pixel）单位，可以根据屏幕宽度自适应。

**（3）JavaScript**

小程序的逻辑层使用JavaScript编写，支持ES6语法。通过Page()函数注册页面，通过App()函数注册小程序实例。

**（4）WXS（WeiXin Script）**

WXS是小程序的脚本语言，运行在渲染层，可以用于处理一些简单的数据格式化操作，提高渲染效率。

### 2.1.4 小程序API

微信小程序提供了丰富的API，主要包括：

- **网络请求API**：wx.request()用于发起HTTP请求
- **数据缓存API**：wx.setStorage()、wx.getStorage()用于本地数据存储
- **媒体API**：wx.chooseImage()、wx.uploadFile()用于图片选择和上传
- **界面API**：wx.showToast()、wx.showModal()用于界面交互
- **开放能力API**：wx.login()、wx.getUserInfo()用于获取用户信息

## 2.2 前端开发技术

### 2.2.1 小程序页面结构

小程序的每个页面由四个文件组成：

| 文件类型 | 作用 | 必需 |
|---------|------|------|
| .wxml | 页面结构 | 是 |
| .wxss | 页面样式 | 否 |
| .js | 页面逻辑 | 是 |
| .json | 页面配置 | 否 |

页面的生命周期函数包括：onLoad（页面加载）、onShow（页面显示）、onReady（页面初次渲染完成）、onHide（页面隐藏）、onUnload（页面卸载）。

### 2.2.2 数据绑定与事件处理

小程序采用数据驱动的开发模式，通过setData()方法更新数据，视图层会自动响应数据变化进行更新。

```javascript
Page({
  data: {
    message: 'Hello World'
  },
  onLoad() {
    this.setData({
      message: '你好，世界'
    });
  },
  handleTap(e) {
    console.log('按钮被点击');
  }
})
```

事件绑定使用bind或catch前缀，如bindtap、catchtap。bind事件会冒泡，catch事件会阻止冒泡。

### 2.2.3 组件化开发

小程序支持自定义组件，可以将页面中可复用的部分抽象为组件，提高代码复用性。组件使用Component()构造器定义，支持properties（属性）、data（数据）、methods（方法）等配置项。

## 2.3 后端开发技术

### 2.3.1 Node.js技术

Node.js是一个基于Chrome V8引擎的JavaScript运行时环境，采用事件驱动、非阻塞I/O模型，具有轻量、高效的特点，特别适合构建数据密集型的实时应用。

Node.js的主要特点包括：

（1）**单线程事件循环**：Node.js采用单线程模型，通过事件循环机制处理并发请求，避免了多线程编程的复杂性。

（2）**非阻塞I/O**：Node.js的I/O操作是异步非阻塞的，可以在等待I/O操作完成的同时处理其他请求，提高了系统吞吐量。

（3）**npm生态系统**：npm是Node.js的包管理器，拥有超过100万个开源包，为开发者提供了丰富的工具和库。

### 2.3.2 Express框架

Express是Node.js最流行的Web应用框架，提供了一系列强大的特性来构建Web应用和API。

Express的核心概念包括：

**（1）路由（Routing）**

路由用于定义应用如何响应客户端请求。Express支持GET、POST、PUT、DELETE等HTTP方法。

```javascript
const express = require('express');
const router = express.Router();

router.get('/projects', (req, res) => {
  // 获取项目列表
});

router.post('/projects', (req, res) => {
  // 创建新项目
});
```

**（2）中间件（Middleware）**

中间件是Express的核心概念，用于处理请求和响应。中间件可以执行任何代码、修改请求和响应对象、结束请求-响应循环、调用下一个中间件。

```javascript
// 身份验证中间件
const authMiddleware = (req, res, next) => {
  const token = req.headers.authorization;
  if (!token) {
    return res.status(401).json({ message: '未授权' });
  }
  // 验证token
  next();
};
```

**（3）错误处理**

Express提供了统一的错误处理机制，通过定义错误处理中间件来捕获和处理应用中的错误。

### 2.3.3 RESTful API设计

REST（Representational State Transfer）是一种软件架构风格，RESTful API是遵循REST原则设计的Web API。

RESTful API的设计原则包括：

（1）**资源导向**：API以资源为中心，每个资源对应一个URI。
（2）**统一接口**：使用标准的HTTP方法（GET、POST、PUT、DELETE）操作资源。
（3）**无状态**：服务器不保存客户端状态，每个请求包含所有必要信息。
（4）**分层系统**：客户端无需知道是否直接连接到服务器。

本系统的API设计示例：

| 方法 | URI | 说明 |
|------|-----|------|
| GET | /api/projects | 获取项目列表 |
| GET | /api/projects/:id | 获取项目详情 |
| POST | /api/projects | 创建项目 |
| PUT | /api/projects/:id | 更新项目 |
| DELETE | /api/projects/:id | 删除项目 |

### 2.3.4 JWT身份认证

JWT（JSON Web Token）是一种开放标准（RFC 7519），用于在各方之间安全地传输信息。JWT由三部分组成：Header（头部）、Payload（负载）、Signature（签名）。

JWT的工作流程：
1. 用户登录，服务器验证用户身份
2. 服务器生成JWT并返回给客户端
3. 客户端将JWT存储在本地
4. 后续请求携带JWT，服务器验证JWT的有效性

```javascript
const jwt = require('jsonwebtoken');

// 生成Token
const token = jwt.sign(
  { id: user.id, username: user.username, role: user.role },
  process.env.JWT_SECRET,
  { expiresIn: '7d' }
);

// 验证Token
const decoded = jwt.verify(token, process.env.JWT_SECRET);
```

## 2.4 数据库技术

### 2.4.1 MySQL数据库

MySQL是最流行的开源关系型数据库管理系统，具有体积小、速度快、成本低等优点，广泛应用于Web应用开发。

MySQL的主要特点：

（1）**关系型数据库**：数据以表格形式存储，表与表之间可以建立关联关系。
（2）**支持SQL语言**：使用标准的SQL语言进行数据操作。
（3）**支持事务**：保证数据操作的原子性、一致性、隔离性、持久性（ACID）。
（4）**支持索引**：通过索引加速数据查询。

### 2.4.2 数据库设计原则

数据库设计遵循以下原则：

**（1）规范化设计**

遵循数据库范式理论，消除数据冗余，保证数据一致性。本系统数据库设计满足第三范式（3NF）要求。

**（2）合理建立索引**

在经常用于查询条件的字段上建立索引，提高查询效率。但索引过多会影响写入性能，需要权衡。

**（3）字段类型选择**

根据数据特点选择合适的字段类型，如使用INT存储整数、VARCHAR存储变长字符串、DATETIME存储日期时间等。

**（4）外键约束**

通过外键约束保证数据的引用完整性，防止出现孤立数据。

### 2.4.3 Node.js操作MySQL

本系统使用mysql2库连接和操作MySQL数据库，支持Promise和连接池。

```javascript
const mysql = require('mysql2/promise');

// 创建连接池
const pool = mysql.createPool({
  host: process.env.DB_HOST,
  user: process.env.DB_USER,
  password: process.env.DB_PASSWORD,
  database: process.env.DB_NAME,
  waitForConnections: true,
  connectionLimit: 10
});

// 执行查询
const [rows] = await pool.query('SELECT * FROM project WHERE id = ?', [id]);
```

## 2.5 系统开发相关理论

### 2.5.1 软件工程方法

本系统开发遵循软件工程的基本原则和方法：

**（1）瀑布模型**

系统开发按照需求分析、系统设计、编码实现、系统测试、部署维护的顺序进行，每个阶段完成后进入下一阶段。

**（2）模块化设计**

将系统划分为多个功能模块，每个模块完成特定的功能，模块之间通过接口进行交互。模块化设计提高了代码的可维护性和可复用性。

**（3）分层架构**

系统采用分层架构，将表示层、业务逻辑层、数据访问层分离，降低层与层之间的耦合度。

### 2.5.2 前后端分离架构

前后端分离是一种现代Web应用开发模式，前端和后端独立开发、独立部署，通过API进行数据交互。

前后端分离的优势：

（1）**开发效率高**：前后端可以并行开发，互不影响。
（2）**技术选型灵活**：前端和后端可以选择各自适合的技术栈。
（3）**易于维护**：前后端代码分离，便于定位和修复问题。
（4）**支持多端**：同一套后端API可以支持Web、小程序、App等多个前端。

### 2.5.3 MVC设计模式

MVC（Model-View-Controller）是一种软件设计模式，将应用分为三个部分：

- **Model（模型）**：负责数据和业务逻辑
- **View（视图）**：负责界面展示
- **Controller（控制器）**：负责接收用户输入，调用模型和视图

本系统后端采用类MVC架构，路由层（Routes）充当控制器角色，数据库操作充当模型角色。
